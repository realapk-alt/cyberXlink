<!DOCTYPE html><html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Device Verification — Neumorphic Light</title>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
  <style>
    /* Neumorphic, soft-light theme inspired by your screenshot */
    :root{
      --page-bg:#eef3f6; /* soft pale */
      --card-bg:#f2f6f8; /* card surface */
      --panel:#e6eef3; /* inner panels */
      --muted:#6b7280; /* grey text */
      --accent:#2f9e44; /* green */
      --accent-strong:#1f7a33;
      --danger:#e11d48;
      --shadow-light: rgba(255,255,255,0.9);
      --shadow-dark: rgba(16,24,40,0.14);
      --radius:18px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, monospace;
    }
    *{box-sizing:border-box;margin:0;padding:0;font-family:Inter,system-ui,-apple-system,'Segoe UI',Roboto,'Helvetica Neue',Arial}
    body{min-height:100vh;background:linear-gradient(180deg,var(--page-bg),#f8fbfd);display:flex;align-items:center;justify-content:center;padding:24px;color:#0f172a}/* Page card */
.page{width:100%;max-width:420px;background:var(--card-bg);border-radius:26px;padding:28px 26px;box-shadow: 14px 14px 32px var(--shadow-dark), -12px -12px 24px var(--shadow-light);border:1px solid rgba(255,255,255,0.6)}

.top-icon{width:78px;height:78px;background:linear-gradient(180deg,#dff3e5,#d6f0df);border-radius:14px;display:flex;align-items:center;justify-content:center;margin:6px auto 12px;box-shadow: inset 4px 4px 8px rgba(16,24,40,0.03), 8px 12px 30px rgba(16,24,40,0.06)}
.top-icon .check{font-size:38px;color:var(--accent-strong)}

h1{font-size:20px;text-align:center;color:#374151;margin-bottom:10px}
.lead{font-size:15px;color:var(--muted);text-align:center;margin-bottom:18px}

/* success message card */
.message{background:var(--panel);padding:14px;border-radius:14px;box-shadow: inset 6px 6px 12px rgba(16,24,40,0.03), inset -6px -6px 12px rgba(255,255,255,0.8);display:flex;gap:12px;align-items:center}
.message .tick{width:36px;height:36px;border-radius:10px;background:linear-gradient(180deg,#dbf6df,#d8f3dc);display:flex;align-items:center;justify-content:center;font-size:20px;color:var(--accent-strong);box-shadow:4px 6px 16px rgba(31,122,51,0.08)}
.message .text{font-size:15px;color:#374151}

/* device info block */
.info-block{margin-top:16px;background:linear-gradient(180deg,#eaf2f7,#e6eef3);padding:12px;border-radius:14px;box-shadow: inset 6px 6px 12px rgba(16,24,40,0.02), 8px 12px 24px rgba(16,24,40,0.03);}

.info-row{display:flex;justify-content:space-between;align-items:center;padding:8px 6px;border-radius:10px}
.info-row + .info-row{margin-top:6px}
.label{color:var(--muted);font-weight:600}
.val{font-family:var(--mono);color:#0b1220;text-decoration:none}

/* token box with inset shadow */
.token-box{margin-top:14px;background:linear-gradient(180deg,#eef6fb,#ecf4fa);padding:10px;border-radius:12px;box-shadow: inset 6px 6px 12px rgba(16,24,40,0.03)}
.token-row{display:flex;justify-content:space-between;gap:12px}

/* progress and close */
.count{margin-top:18px;text-align:center;color:var(--muted)}
.progress{height:10px;background:#e6f3ea;border-radius:999px;margin-top:12px;overflow:hidden}
.progress-bar{height:100%;width:0%;background:linear-gradient(90deg,#2dd36f,#0ea45a);transition:width linear}

.actions{display:flex;gap:12px;margin-top:18px}
.btn-close{flex:0 0 100%;background:var(--card-bg);border-radius:14px;padding:12px;border:1px solid rgba(16,24,40,0.04);box-shadow: 8px 12px 28px rgba(16,24,40,0.06), inset 6px 6px 12px rgba(255,255,255,0.9);color:#be1e2d;font-weight:800;text-align:center;cursor:pointer}

.divider{height:1px;background:rgba(16,24,40,0.04);margin:18px 0;border-radius:2px}

.logs{font-size:13px;color:var(--muted);line-height:1.5}

/* small screens */
@media (max-width:420px){.page{padding:20px}.top-icon{width:64px;height:64px}.btn-close{padding:10px}}

  </style>
</head>
<body>
  <div class="page">
    <div class="top-icon"><div class="check">✔</div></div>
    <h1 id="title">Verification Successful!</h1>
    <div class="lead">Device access has been granted.</div><div class="message">
  <div class="tick">✔</div>
  <div class="text">Device access has been granted.</div>
</div>

<div class="info-block">
  <div class="info-row"><div class="label">Device ID:</div><div id="deviceId" class="val">loading...</div></div>
  <div class="info-row"><div class="label">Access Token:</div><div id="token" class="val">loading...</div></div>
</div>

<div class="token-box">
  <div style="font-size:13px;color:var(--muted);">Window will close in <strong id="countdown">3</strong> seconds</div>
  <div class="progress"><div id="progressBar" class="progress-bar"></div></div>
</div>

<div class="actions">
  <button id="closeBtn" class="btn-close">Close Window</button>
</div>

<div class="divider"></div>

<div class="logs" id="logs">
  <strong>System Logs:</strong><br>
  Firebase: Connecting...<br>
  Verification: Not started
</div>

  </div>  <script>
    // Firebase config (kept)
    const firebaseConfig = {
      apiKey: "AIzaSyBeHXB_9nHTWofFeXKOVUlQYCrB4YhAx_w",
      authDomain: "real-apk-pin.firebaseapp.com",
      databaseURL: "https://real-apk-pin-default-rtdb.firebaseio.com",
      projectId: "real-apk-pin",
      storageBucket: "real-apk-pin.firebasestorage.app",
      messagingSenderId: "345555950697",
      appId: "1:345555950697:web:e215d3e0850299e02096f8",
      measurementId: "G-LPNCNHPYPF"
    };
    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();

    // params
    const params = new URLSearchParams(window.location.search);
    const deviceId = params.get('device');
    const code = params.get('code');

    const deviceEl = document.getElementById('deviceId');
    const tokenEl = document.getElementById('token');
    const logsEl = document.getElementById('logs');

    function setLog(lines){ logsEl.innerHTML = '<strong>System Logs:</strong><br>' + lines.join('<br>'); }

    async function verify(){
      if(!deviceId || !code){ setLog(['Firebase: Connected (Flat Structure)','Verification: Missing device/code']); return; }
      try{
        setLog(['Firebase: Connected (Flat Structure)','Verification: Checking code...']);
        const codeRef = database.ref('verification_codes/' + code);
        const snap = await codeRef.once('value');
        const data = snap.val();
        if(!data){ setLog(['Firebase: Connected (Flat Structure)','Verification: Invalid code']); showError('Invalid verification code'); return; }
        if(data.used === true){ setLog(['Firebase: Connected (Flat Structure)','Verification: Code already used']); showError('This verification code has already been used'); return; }
        if(data.deviceId !== deviceId){ setLog(['Firebase: Connected (Flat Structure)','Verification: Device mismatch']); showError('Verification code does not match device'); return; }
        const now = Date.now();
        if(data.expires_at && now > data.expires_at){ setLog(['Firebase: Connected (Flat Structure)','Verification: Code expired']); showError('Verification code has expired'); return; }
        // mark used
        await codeRef.update({ used: true, used_at: now });
        await database.ref('devices/' + deviceId).set({ verification_time: now });

        // show values
        deviceEl.textContent = deviceId;
        tokenEl.textContent = data.access_token || (Math.random().toString(36).slice(2, 14));
        setLog(['Firebase: Connected (Flat Structure)','Verification: Complete!']);
        showSuccess();
        startCountdown(3);
      }catch(err){ console.error(err); setLog(['Firebase: Connected (Flat Structure)','Verification: Error - ' + (err.message||err)]); showError('Error during verification'); }
    }

    function showSuccess(){ document.getElementById('title').textContent = 'Verification Successful!'; document.querySelector('.lead').textContent = 'Device access has been granted.'; document.querySelector('.message .text').textContent = 'Device access has been granted.'; document.querySelector('.tick').textContent = '✔'; }
    function showError(msg){ document.getElementById('title').textContent = 'Verification Failed'; document.querySelector('.lead').textContent = msg; document.querySelector('.message .text').textContent = msg; document.querySelector('.tick').textContent = '⚠'; }

    function startCountdown(seconds){ const countdown = document.getElementById('countdown'); const bar = document.getElementById('progressBar'); bar.style.transition='none'; bar.style.width='0%'; setTimeout(()=>{ bar.style.transition = `width ${seconds}s linear`; bar.style.width = '100%'; },60); let c=seconds; countdown.textContent=c; const iv=setInterval(()=>{ c--; countdown.textContent=c; if(c<=0){ clearInterval(iv); closeWindow(); } },1000); }

    function closeWindow(){ try{ window.open('','_self').close(); }catch(e){ try{ window.location.href='about:blank'; }catch(e2){ document.body.innerHTML = '<div style="text-align:center;padding:50px;"><h2>Verification Complete</h2><p>You can close this tab.</p></div>'; } } }

    document.getElementById('closeBtn').addEventListener('click', closeWindow);
    window.addEventListener('load', ()=>{ verify(); });
  </script></body>
</html>