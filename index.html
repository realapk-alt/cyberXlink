<!DOCTYPE html><html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Device Verification</title>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
  <style>
    :root{
      --bg1:#f7fafc; --bg2:#ffffff;
      --accent1:#6b46c1; --accent2:#06b6d4;
      --muted:#0f1724; --success:#16a34a; --error:#ef4444;
    }
    *{box-sizing:border-box;margin:0;padding:0;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Arial}
    body{min-height:100vh;display:flex;align-items:center;justify-content:center;padding:20px;background:linear-gradient(135deg,var(--bg1),var(--bg2));color:var(--muted)}
    .card{width:100%;max-width:520px;background:#fff;border-radius:14px;padding:26px;box-shadow:0 18px 60px rgba(2,6,23,0.08);border:1px solid rgba(2,6,23,0.04)}
    .center{display:flex;flex-direction:column;align-items:center;gap:12px}
    .icon{width:96px;height:96px;border-radius:18px;display:flex;align-items:center;justify-content:center;font-size:44px;color:#fff;background:linear-gradient(135deg,var(--accent1),var(--accent2));box-shadow:0 18px 60px rgba(107,70,193,0.12);transition:transform .45s ease}
    .icon.pop{animation:pop .8s ease both}
    @keyframes pop{0%{transform:scale(.9)}50%{transform:scale(1.06)}100%{transform:scale(1)}}
    h1{font-size:18px;color:var(--muted);font-weight:700}
    .lead{font-size:13px;color:rgba(15,23,42,0.6);text-align:center}
    .status-box{width:100%;margin-top:12px;padding:12px;border-radius:10px;background:rgba(240,246,255,0.6);border-left:4px solid var(--accent1);display:flex;align-items:center;justify-content:center;transition:all .3s}
    .status-loading{border-left-color:#f59e0b;color:#92400e}
    .status-success{border-left-color:var(--success);color:var(--success)}
    .status-error{border-left-color:var(--error);color:var(--error)}
    .device-info{margin-top:14px;width:100%;background:rgba(255,255,255,0.9);padding:12px;border-radius:10px;display:flex;flex-direction:column;gap:8px;border:1px solid rgba(2,6,23,0.03)}
    .row{display:flex;justify-content:space-between;align-items:center}
    .label{font-size:13px;color:#64748b}
    .value{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,monospace;color:var(--muted);font-size:13px}
    .count{margin-top:12px;color:rgba(15,23,42,0.65);text-align:center}
    .progress{height:8px;background:#eef2ff;border-radius:999px;margin-top:12px;overflow:hidden}
    .progress-bar{height:100%;width:0%;background:linear-gradient(90deg,var(--accent1),var(--accent2));transition:width linear}
    .actions{display:flex;gap:12px;justify-content:center;margin-top:16px;width:100%}
    .btn{padding:12px 16px;border-radius:12px;border:none;cursor:pointer;font-weight:700}
    .btn.close{background:transparent;border:1px solid rgba(2,6,23,0.06);color:var(--muted);box-shadow:0 6px 20px rgba(2,6,23,0.04)}
    .btn.tele{flex:1 1 auto;background:linear-gradient(90deg,var(--accent1),var(--accent2));color:white;box-shadow:0 12px 36px rgba(107,70,193,0.12);display:inline-flex;align-items:center;justify-content:center;text-decoration:none}
    @media (max-width:480px){.icon{width:80px;height:80px;font-size:36px}}
  </style>
</head>
<body>
  <div class="card">
    <div class="center">
      <div id="icon" class="icon">⏳</div>
      <h1 id="title">Verifying Your Device</h1>
      <div class="lead" id="subtitle">Checking verification code...</div>
      <div id="statusBox" class="status-box status-loading">
        <div id="statusText">Checking verification code...</div>
      </div>
      <div class="device-info">
        <div class="row"><div class="label">Device ID</div><div id="deviceId" class="value">Loading...</div></div>
        <div class="row"><div class="label">Verification Code</div><div id="verificationCode" class="value">Loading...</div></div>
      </div>
      <div class="count">This tab will close in <strong id="countdown">3</strong> seconds</div>
      <div class="progress"><div id="progressBar" class="progress-bar"></div></div>
      <div class="actions">
        <button id="closeBtn" class="btn close">Close</button>
        <a id="teleBtn" class="btn tele" href="https://t.me/aboutofhcs" target="_blank" rel="noopener noreferrer">Join on Telegram</a>
      </div>
    </div>
  </div>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyBeHXB_9nHTWofFeXKOVUlQYCrB4YhAx_w",
      authDomain: "real-apk-pin.firebaseapp.com",
      databaseURL: "https://real-apk-pin-default-rtdb.firebaseio.com",
      projectId: "real-apk-pin",
      storageBucket: "real-apk-pin.firebasestorage.app",
      messagingSenderId: "345555950697",
      appId: "1:345555950697:web:e215d3e0850299e02096f8",
      measurementId: "G-LPNCNHPYPF"
    };
    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();const urlParams = new URLSearchParams(window.location.search);
const deviceId = urlParams.get('device');
const verificationCode = urlParams.get('code');

const deviceIdEl = document.getElementById('deviceId');
const verificationCodeEl = document.getElementById('verificationCode');
const statusTextEl = document.getElementById('statusText');
const statusBox = document.getElementById('statusBox');
const iconEl = document.getElementById('icon');
const titleEl = document.getElementById('title');
const subtitleEl = document.getElementById('subtitle');

deviceIdEl.textContent = deviceId || 'Not provided';
verificationCodeEl.textContent = verificationCode || 'Not provided';

function pop(){iconEl.classList.add('pop');setTimeout(()=>iconEl.classList.remove('pop'),850);}
function setLoading(){statusBox.className='status-box status-loading';statusTextEl.textContent='Checking verification code...';titleEl.textContent='Verifying Your Device';subtitleEl.textContent='Checking verification code...';iconEl.textContent='⏳';pop();}
function setSuccess(){statusBox.className='status-box status-success';statusTextEl.textContent='Verification successful.';titleEl.textContent='Device Verified!';subtitleEl.textContent='Your device has been successfully verified.';iconEl.textContent='✅';pop();}
function setError(msg){statusBox.className='status-box status-error';statusTextEl.textContent=msg;titleEl.textContent='Verification Failed';subtitleEl.textContent=msg;iconEl.textContent='❌';pop();}

async function verifyDevice(){
  if(!deviceId||!verificationCode){setError('Missing device ID or verification code');startCountdown(5);return;}
  try{
    setLoading();
    const codeRef=database.ref('verification_codes/'+verificationCode);
    const snap=await codeRef.once('value');
    const codeData=snap.val();
    if(!codeData){setError('Invalid verification code');startCountdown(5);return;}
    if(codeData.used===true){setError('This verification code has already been used');startCountdown(5);return;}
    if(codeData.deviceId!==deviceId){setError('Verification code does not match device');startCountdown(5);return;}
    const now=Date.now();
    if(codeData.expires_at&&now>codeData.expires_at){setError('Verification code has expired');startCountdown(5);return;}
    await codeRef.update({used:true,used_at:now});
    await database.ref('devices/'+deviceId).set({verification_time:now});
    setSuccess();startCountdown(3);
  }catch(err){console.error(err);setError('Error during verification: '+(err.message||String(err)));startCountdown(5);}
}

function startCountdown(seconds){const countdown=document.getElementById('countdown');const bar=document.getElementById('progressBar');bar.style.transition='none';bar.style.width='0%';setTimeout(()=>{bar.style.transition=`width ${seconds}s linear`;bar.style.width='100%';},80);let c=seconds;countdown.textContent=c;const iv=setInterval(()=>{c--;countdown.textContent=c;if(c<=0){clearInterval(iv);closeTab();}},1000);}

function closeTab(){try{window.open('','_self').close();}catch(e){try{window.location.href='about:blank';}catch(e2){document.body.innerHTML='<div style="text-align:center;padding:50px;"><h2>Verification Complete</h2><p>You can close this tab.</p></div>';}}}

document.getElementById('closeBtn').addEventListener('click',closeTab);
window.addEventListener('load',()=>{setTimeout(verifyDevice,900);setLoading();});

  </script>
</body>
</html>